(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{101:function(e,t,n){},273:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),l=n(90),o=(n(101),n(7)),c=n(276),s=n(45),u=n.n(s),i=n(17),m=n(92),p={isAuthenticated:!1,user:{}},h=n(63),d=Object(i.c)({error:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{message:null},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_ERROR":return Object(h.a)({},e,{message:t.error});case"REMOVE_ERROR":return Object(h.a)({},e,{message:null});default:return e}},auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CURRENT_USER":return{isAuthenticated:!!Object.keys(t.user).length,user:t.user};default:return e}},polls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_POLLS":return t.polls;default:return e}},currentPoll:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CURRENT_POLL":return t.poll;default:return e}}}),f=Object(i.e)(d,{error:{message:null}},Object(i.d)(Object(i.a)(m.a))),b=n(6),E=n.n(b),v=n(93),g=n(11),O=function(e){return{type:"ADD_ERROR",error:e}},j=n(49),w=n.n(j),y={setToken:function(e){e?w.a.defaults.headers.common.Authorization="Bearer ".concat(e):delete w.a.defaults.headers.common.Authorization},call:function(){var e=Object(g.a)(E.a.mark(function e(t,n,a){var r;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a[t]("".concat("http://163.172.180.75:4000/api","/").concat(n),a);case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}},e)}));return function(t,n,a){return e.apply(this,arguments)}}()},k=function(e){return{type:"SET_CURRENT_USER",user:e}},R=function(e){y.setToken(e)},N=function(){return function(e){localStorage.clear(),y.setToken(null),e(k({})),e({type:"REMOVE_ERROR"})}},C=function(e){return{type:"SET_POLLS",polls:e}},S=function(e){return{type:"SET_CURRENT_POLL",poll:e}},A=n(278),x=n(274),T=n(279),_=n(277),P=n(21),V=n(22),L=n(23),F=n(25),M=n(24),U=n(26),D=n(4),q=function(e){function t(e){var n;return Object(V.a)(this,t),(n=Object(F.a)(this,Object(M.a)(t).call(this,e))).state={username:"",password:"",ethAddress:""},n.handleChange=n.handleChange.bind(Object(D.a)(Object(D.a)(n))),n.handleSubmit=n.handleSubmit.bind(Object(D.a)(Object(D.a)(n))),n}return Object(U.a)(t,e),Object(L.a)(t,[{key:"handleChange",value:function(e){this.setState(Object(P.a)({},e.target.name,e.target.value))}},{key:"handleSubmit",value:function(e){var t=this.state,n=t.username,a=t.password,r=t.ethAddress,l=this.props.authType;e.preventDefault(),this.props.authUser(l||"login",{username:n,password:a,ethAddress:r})}},{key:"render",value:function(){var e,t,n=this.state,a=n.username,l=n.password,o=n.ethAddress,c=this.props.authType;return"register"===c?(e=r.a.createElement("input",{type:"text",value:o,name:"ethAddress",onChange:this.handleChange,autoComplete:"off",className:"form-input"}),t=r.a.createElement("label",{className:"form-label",htmlFor:"ethAddress"},"ethAddress (optional for login) "," ")):e=null,r.a.createElement("div",null,r.a.createElement("h1",{className:"poll-title"},c),r.a.createElement("form",{className:"form",onSubmit:this.handleSubmit},r.a.createElement("label",{className:"form-label",htmlFor:"username"},"username"," "),r.a.createElement("input",{type:"text",value:a,name:"username",onChange:this.handleChange,autoComplete:"off",className:"form-input"}),r.a.createElement("label",{className:"form-label",htmlFor:"password"},"password"," "),r.a.createElement("input",{type:"password",value:l,name:"password",onChange:this.handleChange,autoComplete:"off",className:"form-input"}),t," ",e,r.a.createElement("div",{className:"buttons_center"},r.a.createElement("button",{className:"button",type:"submit"},"Submit"))))}}]),t}(a.Component),I=Object(o.b)(function(){return{}},{authUser:function(e,t){return function(){var n=Object(g.a)(E.a.mark(function n(a){var r,l,o,c;return E.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,y.call("post","auth/".concat(e),t);case 3:r=n.sent,l=r.token,o=Object(v.a)(r,["token"]),localStorage.setItem("jwtToken",l),y.setToken(l),a(k(o)),a({type:"REMOVE_ERROR"}),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(0),c=n.t0.response.data,a(O(c.message));case 16:case"end":return n.stop()}},n,null,[[0,12]])}));return function(e){return n.apply(this,arguments)}}()},logout:N})(q),W=Object(o.b)(function(e){return{error:e.error}})(function(e){var t=e.error;return r.a.createElement(a.Fragment,null," ",t.message&&r.a.createElement("div",{className:"error"},t.message)," ")}),z=function(e){var t=e.authType;return e.isAuthenticated?r.a.createElement(_.a,{to:"/"}):r.a.createElement("div",null,r.a.createElement(W,null),r.a.createElement(I,{authType:t}))},B=n(64),J=function(){return"#"+Math.random().toString(16).slice(2,8)},Q=Object(o.b)(function(e){return{poll:e.currentPoll}},{vote:function(e,t){return function(){var n=Object(g.a)(E.a.mark(function n(a){var r,l;return E.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,y.call("post","polls/".concat(e),t);case 3:r=n.sent,a(S(r)),a({type:"REMOVE_ERROR"}),n.next=12;break;case 8:n.prev=8,n.t0=n.catch(0),l=n.t0.response.data,a(O(l.message));case 12:case"end":return n.stop()}},n,null,[[0,8]])}));return function(e){return n.apply(this,arguments)}}()},deletePoll:function(e){return function(){var t=Object(g.a)(E.a.mark(function t(n){var a,r,l;return E.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,y.call("delete","polls/".concat(e));case 3:return a=t.sent,n(S(a)),t.next=7,y.call("get","polls");case 7:r=t.sent,n(C(r)),n({type:"REMOVE_ERROR"}),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),l=t.t0.response.data,n(O(l.message));case 16:case"end":return t.stop()}},t,null,[[0,12]])}));return function(e){return t.apply(this,arguments)}}()}})(function(e){var t=e.poll,n=e.vote,a=e.deletePoll,l=t.options&&t.options.map(function(e){return r.a.createElement("button",{onClick:function(){return n(t._id,{answer:e.option})},className:"button",key:e._id},e.option)}),o=t.options&&{labels:t.options.map(function(e){return e.option}),datasets:[{label:t.question,backgroundColor:t.options.map(function(e){return J()}),borderColor:"#323643",data:t.options.map(function(e){return e.votes})}]},c=t.options&&{labels:t.options.map(function(e){return e.option}),datasets:[{label:t.question,backgroundColor:t.options.map(function(e){return J()}),borderColor:"#323643",data:t.options.map(function(e){return e.votes})}]};return r.a.createElement("div",null,r.a.createElement("div",{className:"pie"},r.a.createElement("h3",{className:"poll-title"},t.question),r.a.createElement("h2",null,"Infos from mongoDB"),r.a.createElement("div",{className:"buttons_center"},l),t.options&&r.a.createElement(B.a,{data:o})),r.a.createElement("button",{className:"button",onClick:function(){return a(t._id)}},"Delete poll"),r.a.createElement("div",{className:"pie"},r.a.createElement("h2",null,"Infos from the smart contract associated"),t.options&&r.a.createElement(B.a,{data:c})))}),$=function(e){function t(e){var n;return Object(V.a)(this,t),(n=Object(F.a)(this,Object(M.a)(t).call(this,e))).handleSelect=n.handleSelect.bind(Object(D.a)(Object(D.a)(n))),n}return Object(U.a)(t,e),Object(L.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.getPolls)()}},{key:"handleSelect",value:function(e){this.props.history.push("/polls/".concat(e))}},{key:"render",value:function(){var e=this,t=this.props,n=t.getPolls,l=t.getUserPolls,o=t.auth,c=this.props.polls.map(function(t){return r.a.createElement("li",{onClick:function(){return e.handleSelect(t._id)},key:t._id},t.question)});return r.a.createElement(a.Fragment,null,o.isAuthenticated&&r.a.createElement("div",{className:"buttons_center"},r.a.createElement("button",{className:"button",onClick:n},"All polls"),r.a.createElement("button",{className:"button",onClick:l},"My polls")),r.a.createElement("div",{className:"form"},r.a.createElement("ul",{className:"polls"},c)))}}]),t}(a.Component),G=Object(o.b)(function(e){return{auth:e.auth,polls:e.polls}},{getPolls:function(){return function(){var e=Object(g.a)(E.a.mark(function e(t){var n,a;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.call("get","polls");case 3:n=e.sent,t(C(n)),t({type:"REMOVE_ERROR"}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),a=e.t0.response.data,t(O(a.message));case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}()},getUserPolls:function(){return function(){var e=Object(g.a)(E.a.mark(function e(t){var n,a;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.call("get","polls/user");case 3:n=e.sent,t(C(n)),t({type:"REMOVE_ERROR"}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),a=e.t0.response.data,t(O(a.message));case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}()}})($),H=n(34),K=function(e){function t(e){var n;return Object(V.a)(this,t),(n=Object(F.a)(this,Object(M.a)(t).call(this,e))).state={question:"",options:["",""],voters:["",""]},n.handleChange=n.handleChange.bind(Object(D.a)(Object(D.a)(n))),n.handleSubmit=n.handleSubmit.bind(Object(D.a)(Object(D.a)(n))),n.addAnswer=n.addAnswer.bind(Object(D.a)(Object(D.a)(n))),n.handleAnswer=n.handleAnswer.bind(Object(D.a)(Object(D.a)(n))),n.handleVoter=n.handleVoter.bind(Object(D.a)(Object(D.a)(n))),n.addVoter=n.addVoter.bind(Object(D.a)(Object(D.a)(n))),n}return Object(U.a)(t,e),Object(L.a)(t,[{key:"handleChange",value:function(e){this.setState(Object(P.a)({},e.target.name,e.target.value))}},{key:"addVoter",value:function(){this.setState({voters:[].concat(Object(H.a)(this.state.voters),[""])})}},{key:"addAnswer",value:function(){this.setState({options:[].concat(Object(H.a)(this.state.options),[""])})}},{key:"handleAnswer",value:function(e,t){var n=Object(H.a)(this.state.options);n[t]=e.target.value,this.setState({options:n})}},{key:"handleVoter",value:function(e,t){var n=Object(H.a)(this.state.voters);n[t]=e.target.value,this.setState({voters:n})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.props.createPoll(this.state)}},{key:"render",value:function(){var e=this,t=this.state.options.map(function(n,l){return r.a.createElement(a.Fragment,{key:l},r.a.createElement("label",{className:"form-label"},"option"),r.a.createElement("input",{className:"form-input",type:"text",value:t,onChange:function(t){return e.handleAnswer(t,l)}}))}),n=this.state.voters.map(function(t,l){return r.a.createElement(a.Fragment,{key:l},r.a.createElement("label",{className:"form-label"},"voter"),r.a.createElement("input",{className:"form-input",type:"text",value:n,onChange:function(t){return e.handleVoter(t,l)}}))});return r.a.createElement("form",{className:"form",onSubmit:this.handleSubmit},r.a.createElement("label",{className:"form-label",htmlFor:"question"},"question"),r.a.createElement("input",{className:"form-input",type:"text",name:"question",value:this.state.question,onChange:this.handleChange}),r.a.createElement("div",{className:"container"},t,r.a.createElement("div",{className:"buttons_center"},r.a.createElement("button",{className:"button",type:"button",onClick:this.addAnswer},"Add options")),r.a.createElement("div",{className:"container"},n),r.a.createElement("div",{className:"buttons_center"},r.a.createElement("button",{className:"button",type:"button",onClick:this.addVoter},"Add Voter")),r.a.createElement("div",{className:"buttons_center"},r.a.createElement("button",{className:"button",type:"submit"},"Submit"))))}}]),t}(a.Component),X=Object(o.b)(function(){return{}},{createPoll:function(e){return function(){var t=Object(g.a)(E.a.mark(function t(n){var a,r;return E.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,console.log("wesh c ladata :",e),t.next=4,y.call("post","polls",e);case 4:a=t.sent,n(S(a)),n({type:"REMOVE_ERROR"}),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(0),r=t.t0.response.data,n(O(r.message));case 13:case"end":return t.stop()}},t,null,[[0,9]])}));return function(e){return t.apply(this,arguments)}}()}})(K);if(localStorage.jwtToken){R(localStorage.jwtToken);try{f.dispatch(k(u()(localStorage.jwtToken)))}catch(se){f.dispatch(k({})),f.dispatch(O(se))}}var Y=Object(T.a)(function(e){return r.a.createElement(o.a,{store:f},r.a.createElement(a.Fragment,null,r.a.createElement("h1",null,"UI Test Page"),r.a.createElement("h2",null,"Testing Error Component: "),r.a.createElement(W,null),r.a.createElement("hr",null),r.a.createElement("h2",null,"Testing Auth Component: "),r.a.createElement(I,null),r.a.createElement("hr",null),r.a.createElement("h2",null,"Testing Create Poll Component: "),r.a.createElement(X,null),r.a.createElement("hr",null),r.a.createElement("h2",null,"Testing Polls Component: "),r.a.createElement(G,e),r.a.createElement("hr",null),r.a.createElement("h2",null,"Testing Poll Component: "),r.a.createElement(Q,null),r.a.createElement("hr",null),r.a.createElement("h2",null,"Testing Drizzle contract Component: "),r.a.createElement("hr",null)))}),Z=function(e){return r.a.createElement("div",null,r.a.createElement(G,e),r.a.createElement(W,null))},ee=function(e){var t=e.match;return(0,e.getPoll)(t.params.id),r.a.createElement("div",null,r.a.createElement(W,null),r.a.createElement(Q,null))},te=function(e){return e.isAuthenticated?r.a.createElement("div",null,r.a.createElement(W,null),r.a.createElement(X,null)):r.a.createElement(_.a,{to:"/login"})},ne=Object(T.a)(Object(o.b)(function(e){return{auth:e.auth}},{getCurrentPoll:function(e){return function(){var t=Object(g.a)(E.a.mark(function t(n){var a,r;return E.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,y.call("get","polls/".concat(e));case 3:a=t.sent,n(S(a)),n({type:"REMOVE_ERROR"}),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),r=t.t0.response.data.error,n(O(r));case 12:case"end":return t.stop()}},t,null,[[0,8]])}));return function(e){return t.apply(this,arguments)}}()}})(function(e){var t=e.auth,n=e.getCurrentPoll;return r.a.createElement("main",null,r.a.createElement(A.a,null,r.a.createElement(x.a,{exact:!0,path:"/",render:function(e){return r.a.createElement(Z,e)}}),r.a.createElement(x.a,{exact:!0,path:"/login",render:function(){return r.a.createElement(z,{authType:"login",isAuthenticated:t.isAuthenticated})}}),r.a.createElement(x.a,{exact:!0,path:"/poll/new",render:function(){return r.a.createElement(te,{isAuthenticated:t.isAuthenticated})}}),r.a.createElement(x.a,{exact:!0,path:"/register",render:function(){return r.a.createElement(z,{authType:"register",isAuthenticated:t.isAuthenticated})}}),r.a.createElement(x.a,{exact:!0,path:"/polls/:id",render:function(e){return r.a.createElement(ee,Object.assign({getPoll:function(e){return n(e)}},e))}}),r.a.createElement(x.a,{exact:!0,path:"/test",render:function(){return r.a.createElement(Y,null)}})))})),ae=n(275),re=Object(o.b)(function(e){return{auth:e.auth}},{logout:N})(function(e){var t=e.auth,n=e.logout;return r.a.createElement("nav",{className:"navbar"},r.a.createElement("div",{className:"container"},r.a.createElement("ul",{className:"navbar-container"},r.a.createElement("li",null,r.a.createElement(ae.a,{className:"navbar-brand",to:"/"},"Poll app")),!t.isAuthenticated&&r.a.createElement(a.Fragment,null,r.a.createElement("li",null,r.a.createElement(ae.a,{className:"button",to:"/register"},"Register")),r.a.createElement("li",null,r.a.createElement(ae.a,{className:"navbar-item",to:"/login"},"Login"))),t.isAuthenticated&&r.a.createElement(a.Fragment,null,r.a.createElement("li",null,r.a.createElement(ae.a,{className:"navbar-item",to:"/poll/new"},"New Poll")),r.a.createElement("li",null,r.a.createElement("a",{className:"navbar-item",onClick:n},"Logout")))),t.isAuthenticated&&r.a.createElement("p",{className:"navbar-user"},"Logged in as ",t.user.username)))});if(localStorage.jwtToken){R(localStorage.jwtToken);try{f.dispatch(k(u()(localStorage.jwtToken)))}catch(se){f.dispatch(k({})),f.dispatch(O(se))}}var le=function(){return r.a.createElement(o.a,{store:f},r.a.createElement(c.a,null,r.a.createElement(a.Fragment,null,r.a.createElement(re,null),r.a.createElement(ne,null))))},oe=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ce(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}Object(l.render)(r.a.createElement(le,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("","/service-worker.js");oe?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):ce(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):ce(e)})}}()},96:function(e,t,n){e.exports=n(273)}},[[96,1,2]]]);
//# sourceMappingURL=main.600c2992.chunk.js.map